<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.542">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W. Christopher Carleton">
<meta name="author" content="Sarah Klassen">
<meta name="author" content="John Murphy">
<meta name="author" content="Patrick Roberts">
<meta name="dcterms.date" content="2024-12-05">

<title>Beyond the Low-Density vs.&nbsp;High-Density Urbanism Binary: Angkor and Hampshire as Scaled Versions of the Same Spatial Logic</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="carleton_etal_lowdensity_quantified_files/libs/clipboard/clipboard.min.js"></script>
<script src="carleton_etal_lowdensity_quantified_files/libs/quarto-html/quarto.js"></script>
<script src="carleton_etal_lowdensity_quantified_files/libs/quarto-html/popper.min.js"></script>
<script src="carleton_etal_lowdensity_quantified_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="carleton_etal_lowdensity_quantified_files/libs/quarto-html/anchor.min.js"></script>
<link href="carleton_etal_lowdensity_quantified_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="carleton_etal_lowdensity_quantified_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="carleton_etal_lowdensity_quantified_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="carleton_etal_lowdensity_quantified_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="carleton_etal_lowdensity_quantified_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Beyond the Low-Density vs.&nbsp;High-Density Urbanism Binary: Angkor and Hampshire as Scaled Versions of the Same Spatial Logic</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">W. Christopher Carleton </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of the Co-evolution of Land-use and Urbanism, Max Planck Institute of Geoanthropology, Jena, Germany
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Sarah Klassen </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            To be determined
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">John Murphy </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            To be determined
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Patrick Roberts </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of the Co-evolution of Land-use and Urbanism, Max Planck Institute of Geoanthropology, Jena, Germany
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>Since the concept of low-density urbanism was introduced to urban archaeology, it has become a widely accepted but loosely defined label applied to diverse sites and ancient cultures around the world. It broadly refers to settlements that have certain features or evidence considered indicative of urban processes—like civic ceremonial monuments, heterogeneous economic activity, and formal public spaces—but a spatial structure that differs from familiar preindustrial cities. Unlike compact, walled cities, low-density forms appear to have had more diffuse building patterns, integrated agro-urban land-use, no steep density gradients, and they lacked formal boundaries distinguishing urban from rural space. The type-site for low-density urban settlement is Angkor, the eponymous political, economic, and religious centre of the Angkorian World located in modern-day Cambodia (c.&nbsp;800-1500 CE). Frequently, Angkor is juxtaposed with pre-modern compact urbanism, represented by walled medieval European settlements, for example. But, these labels have never been given concrete quantitative definitions and low-density urban centres have never been directly, quantitatively compared with the complimentary, high-density types in a systematic way beyond rough estimates of overall building density based on arbitrary settlement boundaries. Using a newly developed Python package for temporally aware spatial archaeological research called ChronoCluster, we employed pairwise distance density functions to directly compare Angkor’s spatial structure to that of Medieval Hampshire as recorded in the Domesday survey of the mid-11th century CE. Our analysis revealed a striking similarity that suggests perhaps the two seemingly different settlement patterns may be scaled versions of the same underlying urban process. This finding raises new questions about the mechanisms affecting urban form and challenges the prevailing dichotomy between low-density and compact premodern urbanism.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Urbanism is one of the most enduring and recurrent organizing principles in human history. For at least 5,500 years, and likely much longer, societies across the world have independently developed places that concentrate a mix of human activities, creating hubs of economic, political, and social interaction. Just as feudalism or capitalism are more than descriptions of political and economic conditions, urbanism is more than just a pattern of settlement—it is a structuring force that reflects, shapes, and reinforces the social and economic relationships among people, affecting individual and collective behaviour. These places intensify and multiply human interaction leading to what some scholars have called “energized crowding” or “social reactors”, both terms emphasizing the catalytic potential of urban spaces. Many of these settlements are easily recognizable in the archaeological record because they frequently resemble the familiar cities of today in terms of functions and traits, like posessing public spaces, formal street networks, and public architecture. Many also have high building densities relative to their surroundings or other settlements and, in some parts of the world, walls that demarcate their boundaries. Others, however, challenge familiar models, with examples like the Classic Maya civic-ceremonial centres and the Angkor urban complex prompting some archaeologists to posit the existence of a distinct kind of premodern urbanism: low-density agrarian urbanism.</p>
<p>Interdisciplinarity and advances in archaoelogy led to the proposition that premodern urbanism took dinstinct forms. Sociologists, geographers, and urban studies scholars have recognized that since the industrial era, cities have undergone cycles of de-densification, producing sprawling, mixed-use landscapes that blur the boundaries between urban and rural. Some have evolved into formally recognized, more-or-less continuous urban-industrial metropolitan regions, like the Greater Vancouver Regional District in Canada. Others have expanded into vast, interconnected urban-industrial-agricultural corridors, such as the Northeast Megalopolis in the United States. Similar patterns have been identified in parts of Asia, where “desakota”—a portmanteau combining the Indonesian <em>desa</em> (“village”) and <em>kota</em> (“city”)—describes agro-urban spaces that stretch continuously from dense urban cores out into their surrounding countrysides. Drawing on archaeological survey, mapping, and advances in remote sensing, some archaeologists have identified visually similar patterns at Angkor and in Classic Maya cities. These observations led to the adoption of the terms like “low-density agrarian urbanism” in the archaeological literature used to describe sprawling, extensively cultivated mixed-use urban spaces. These low-density forms have been contrasted with the compact, nucleated cities of the past (e.g., walled medieval or bronze age Mesopotamian cities) characterized by a more definitive boundary separating the urban from the rural, something we refer to here as the “urbs-ex-rural” form.</p>
<p>If the apparent difference between these forms reflects real underlying differences, it suggests urbanism has historically taken multiple distinct trajectories. This would, in turn, imply different ways of structuring urban societies in the past and differences in both individual and collective urban behaviour. Additionally, the near-total collapse of these nominally low-density systems before the modern era raises critical questions about their long-term viability—questions that are particularly relevant today as cities worldwide continue to expand outward rather than upward. But, the distinction has never been formally tested, leading to key questions: Is this distinction real or meaningful? Does the archaeological record truly show multiple, fundamentally different, forms of urbanism, or are these merely variations on a shared underlying organizing principle?</p>
<p>To evaluate this question, we present the first quantitative spatial comparison involving two key case studies: Ancient Angkor and Medieval Hampshire. These settlement areas are often framed as belonging to fundamentally different urban categories—Angkor is the archetypal example of premodern low-density urbanism, and Hampshire has largely been regarded as an example of conventional European settlement hierarchy centred on the urbs-ex-rural form. Angkor, as we explained, serves as the type-site for low-density urbanism. As the capital of the Khmer Empire between the 9th and 15th centuries CE, it has been widely interpreted as a decentralized, agrarian-based urban system, structured around an extensive network of temples, reservoirs, canals, and dispersed habitation zones. Over the past several decades, lidar surveys, satellite imagery, and ground-based mapping have revealed a vast, integrated settlement system spanning over 1,000 km², prompting many scholars to refer to it as the largest known premodern urban complex in the world. In contrast, Medieval Hampshire, and particularly its urban core at Winchester, has never been classified as low-density urbanism per se (cf.&nbsp;REF), yet it presents an important comparative case. Like Angkor, it consisted of a spatially distributed system of socioeconomic and institutional centers embedded within an agrarian landscape. Winchester functioned as a key administrative and economic hub from the late Anglo-Saxon period through the Norman conquest of 1066 and beyond, yet it was not an isolated entity. Instead, it was linked to a broader network of villages, monasteries, estates, and market centers, forming a dispersed political and economic landscape that in some ways parallels the organization seen at Angkor.</p>
<p>We applied advanced spacetime archaoelogical analysis to compare Angkor and Hampshire from the bottom-up. In the case of Angkor, we used a large database of community temple locations, which played a central role in religious life, agricultural organization, and local production. These temples were not merely places of worship but also hubs for economic redistribution, labor mobilization, royal administration, dispute resolution, and power negotiation, reflecting a deeply integrated system of state control and sacred authority as well as tensions between local elites and royalty. Their role in sustaining the Angkorian system has been widely documented, particularly through rice and labor contributions to central administration. For medieval Hampshire, we used the distribution of manorial estates, which formed the backbone of feudal economic and political organization. These estates, whether secular or church-owned, structured land tenure, resource extraction, and local governance. They supported agricultural production, military obligations, and judicial functions, acting as the key nodes in a hierarchical system linking lords, vassals, and monarchs. Like Angkor’s temples, manorial estates facilitated local economic redistribution and had obligations to central authority—whether through rents, dues, or military service.</p>
<p>Despite their apparent differences, then, these two systems share striking functional parallels: both structured agricultural production and redistribution, supported state-level infrastructure, and reinforced ideologies of rulership—divine right in feudal Europe and sacred cosmology in Angkor. Each also played a role in economic and administrative networks, with manorial estates supporting feudal obligations while temples linked agrarian communities to Angkor’s centralized administration. In both cases, these nodes were embededded in larger regional eocnomic and power networks and reflected/affected tensions at multiple levels between state-like centralization and the centripedal force of local elites. We aruge, therfore, that these comparisons justify the use of these datasets as valid spatial proxies for socioeconomic and political organization relevant to questions about urban settlement structure, allowing us to directly assess structural similarities and differences in urban-rural dynamics between Angkor (with its low-density agro-urban label) and medieval Hampshire (representative of the default, ‘urbs-ex-rural’ model). Further details on these functional parallels are summarized in Table 1.</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 40%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Comparative Aspect</strong></th>
<th><strong>Manorial Estates (Medieval Europe)</strong></th>
<th><strong>Community Temples (Angkor)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Primary Function</strong></td>
<td>Feudal economic and social organization</td>
<td>Religious worship, community integration, agircultural production</td>
</tr>
<tr class="even">
<td><strong>Key Contribution to Rulers</strong></td>
<td>Military service, rents, and dues</td>
<td>Rice and labor contributions</td>
</tr>
<tr class="odd">
<td><strong>Core Role</strong></td>
<td>Local production and redistribution; religious for church-owned estates</td>
<td>Local production and redistribution, along with ritual and spiritual services</td>
</tr>
<tr class="even">
<td><strong>Connection to State</strong></td>
<td>Feudal hierarchy linking lords and vassals</td>
<td>Centralized administration under the king (degree of centralization varying through time)</td>
</tr>
<tr class="odd">
<td><strong>Symbolism</strong></td>
<td>Feudal order legitimised by divine right</td>
<td>Sacred cosmology and royal divine mandate</td>
</tr>
<tr class="even">
<td><strong>Autonomy</strong></td>
<td>Local judicial and administrative autonomy</td>
<td>Centralized integration into royal networks</td>
</tr>
<tr class="odd">
<td><strong>Economic Foundation</strong></td>
<td>Mixed agriculture/livestock, markets</td>
<td>Rice agriculture, craft production, some external trade</td>
</tr>
<tr class="even">
<td><strong>Infrastructure Supported</strong></td>
<td>Castles, manorial courts, and local defense</td>
<td>Temples, irrigation systems, and state projects</td>
</tr>
<tr class="odd">
<td><strong>Cultural Context</strong></td>
<td>Secular with some religious undertones; overtly religious for church-owned estates</td>
<td>Deeply rooted in Hindu-Buddhist traditions</td>
</tr>
<tr class="even">
<td><strong>Type of Obligation</strong></td>
<td>Military and economic</td>
<td>Religious and agricultural</td>
</tr>
</tbody>
</table>
<p>To evaluate whether Angkor and Hampshire exhibit fundamentally different spatial structures, we compared the two cases using pairwise distance density (PDD) functions available in the <code>ChronoCluster</code> Python package. The <code>ChronoCluster</code> package was developed following a spacetime archaeology paradigm, explicitly designed to account for chronometric uncertainty. Each point in a <code>ChronoCluster</code> point set is assigned both spatial and temporal coordinates, with probability distributions reflecting temporal uncertainties. The package uses these distributions to calculate the probability that a given point existed in the relevant point-set at any given time, enabling temporally-weighted spatial statistics and the propagation of temporal uncertainty into spatial analyses. Using these tools, we produced PDD functions for comparison between the two settlement areas. Building a PDD involves computing all pairwise inter-point distances for a given point-set and then approximating the distribution of those distances with a density function. These distributions reveal multiscale structure in the point set, including clustering and repulsion, across inter-point distances. These patterns, in turn, provide insight into the underlying spatial logic of settlement organization. Importantly, <code>ChronoCluster</code> allowed us to propagate chronological uncertainties about the start and end times of the points in our point sets. This was most relevant for Angkor because, unlike the Domesday Book with well-known historical provenience, the Angkorian temple foundation dates have primarily been estimated using Bayesian modelling and machine learning approaches, which have temporal uncertainties associated with them that need to be considered and propagated along the analytical pipeline. We reasoned that if the PDDs in the two cases revealed different spatial structures, the finding would support the prevailing assumptions that Angkor represents a distinct kind of low-density premodern urbanism. If, however, the results revealed similar underlying spatial structures, the finding would challenge the idea that premodern low-density urbanism differed significantly from other forms, suggesting that these two seemingly distinct urban traditions represent variations on a common spatial logic.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h2>
<p>Our analysis involved two sets of point data. The first dataset consisted of 1431 community temple locations in the Greater Angkor area, 105 of which have foundation dates estimated directly using epigraphy and/or art and architectural assessments. We acquired the point data from the supplementary material of Carleton et al.&nbsp;and followed the methods of that study to estimate posterior age estimates for the foundation dates of the 1326 undated temples. We then estimated a mean and standard deviation from the posterior samples for each modelled foundation date. These parameter estimates were subsequently used to define normal (Gaussian) distributions for the foundation dates of the temples. The directly dated temples, in contrast, were assigned Dirac delta densities (constant dates, effectively) for their start times with no uncertainty because they come from historical (epigraphic) data and/or art history assessments with no associated uncertainty estimates. Since no direct chronological information about temple or community abandonment are available for Angkor, we used Dirac delta densities to represent the end date distributions of all temples with the distributions centred on the historically defined political abandonment of Angkor at 1435 CE. The different temple foundation dates (both exmprical and modelled) along with the chronological uncertainty in those dates meant that we had sufficient information to evaluate change over time in the point pattern representing Angkor’s urban trajectory.</p>
<p>The second dataset consisted of 435 manorial estates located in Medieval Hampshire listed in the Domesday Book. Shortly after his victory over Harold II at the Battle of Hastings in 1066 CE, William I commissioned a survey of England’s lands, aiming to strengthen Norman control and lay the foundations for his administrative reforms. The survey concluded in 1086 CE and results were compiled into the multi-volume Domesday Book. Entries in the book pertain to manorial estates—economic, social, and administrative units of land, organized under the feudal system and directly controlled by a lord or the Catholic Church. The contents of the book were translated and digitised in 2015 by scholars at the University of Hull and the National Archives, a process that included deducing the locations or manorial estates (down to 100m by 100m UK Ordinance Survey grid squares). We downloaded the raw data, including point locations, from the University of Hull website. We then isolated the points listed as within the county of Hampshire and cleaned a couple instances of points well outside the county having been duplicated and mislabelled as belonging to ‘Hampshire’—this problem was first noticed because the maximum inter-point distances calculated during our analysis were initially far larger than expected and subsequent plotting in QGIS (https://qgis.org) revealed two ‘Hampshire’ points in other, distant counties that had identical coordinates to points with different (locally appropriate) county labels. Next, we used Dirac delta functions to represent the densities associated with start and end dates for each location and set the relevant parameters corresponding to the period between the Battle of Hastings in 1066 CE and the conclusion of the Domesday survey in 1086 CE. Effectively, the use of shared, historically-derived start and end dates for the point data representing Hampshire’s settlement trajectory meant we could infer an historical snapshot of the spatial logic behind the point pattern.</p>
</section>
<section id="spacetime-modelling-of-pdds-with-chronological-uncertainty" class="level2">
<h2 class="anchored" data-anchor-id="spacetime-modelling-of-pdds-with-chronological-uncertainty">Spacetime Modelling of PDDs with Chronological Uncertainty</h2>
<p>Our primary focus was on estimating and comparing the PDD functions between the case studies based on point data representing hierarchically nested socioeconomic nodes embedded in managed agrarian landscapes. As we mentioned, PDD functions are densities that represent the relative frequency of pairwise distances in a given point set. They are a staple of spatial analysis in geography and have been used in archaeology for many decades. The function characterizes multiscalar (across all possible pairwise distances) structure in point process distributions, enabling direct comparisons between different point patterns. In general, estimating a PDD involves measuring inter-point distances for all possible point dyads and then representing the resulting distribution with a histogram or smooth density estimate. Here we used a standard Gaussian Kernel Density Estimate (KDE) for each set of <span class="math inline">\(n\)</span> inter-point distances, <span class="math inline">\((x_1, x_2, \ldots, x_n)\)</span>, which was given by:</p>
<p><span class="math display">\[
\hat{f}(x) = \frac{1}{n h \sqrt{2\pi}} \sum_{i=1}^{n} \exp \left( -\frac{(x - x_i)^2}{2h^2} \right)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{f}(x)\)</span> is the estimated probability density function at <span class="math inline">\(x\)</span>,</li>
<li><span class="math inline">\(n\)</span> is the number of inter-point distances,</li>
<li><span class="math inline">\(x_i\)</span> are the observed inter-point distances,</li>
<li><span class="math inline">\(h\)</span> is the bandwidth parameter, controlling the degree of smoothing,</li>
<li>The kernel function <span class="math inline">\(K(u)\)</span> is given by the standard Gaussian kernel:</li>
</ul>
<p><span class="math display">\[
K(u) = \frac{1}{\sqrt{2\pi}} e^{- \frac{1}{2} u^2}
\]</span></p>
<p>which corresponds to the probability density function of a standard normal distribution.</p>
<p>The bandwidth parameter <span class="math inline">\(h\)</span> was automatically computed using Scott’s rule of thumb:</p>
<p><span class="math display">\[
h = \sigma n^{-1/5}
\]</span></p>
<p>where <span class="math inline">\(\sigma\)</span> is the sample standard deviation of the inter-point distances, and <span class="math inline">\(n\)</span> is the number of distances in the dataset. This method is a widely used heuristic for kernel density estimation, aiming to balance bias and variance in the density estimate.</p>
<p>To account for chronological uncertainty and potential change over time in archaeological point patterns, we we used a new python package called <code>ChronoCluster</code>. The package adopts a spacetime perspective for modelling archaeological data, which means that both space and time are considered dimensions that make up a spacetime volume—imagine a 3D cube containing a cloud of points where spatial coordinates are represented by the x- and y-axes while time is represented by a vertical z-axis. Each point in the volume is considered an abstract ‘event’ and has some temporal persistence represented by a vertical line connecting its start- and end-times. These lines are commonly called a “world lines” in physics and so we adopt the same terminology here. Each world line extends through the spacetime volume, allowing us to capture both spatial clustering and temporal persistence within a unified framework. A cornerstone of spacetime modelling with the <code>ChronoCluster</code> package is the calculation of “inclusion probabilities” given uncertain start- and end-date distributions for each point’s world line. The package can calculate the probability that a given point existed—i.e., should be included in the point set—at any time (or “time slice”) inside the spacetime volume. To perform the calculation, the package has to assign a random variable with a valid probability density function (<span class="math inline">\(PDF(x)\)</span>), a valid cumulative probability density function (<span class="math inline">\(CDF(x)\)</span>), and a valid survival function (<span class="math inline">\(S(x)\)</span>) to the start- and end-coordinates of the point on the time-axis. Then, the probability that the point existed at any given time, <span class="math inline">\(p(t)\)</span>, is the probability that the event’s world line has started, <span class="math inline">\(p_\alpha(t)\)</span>, multiplied by the probability that it has not yet ended, <span class="math inline">\(\neg{p_\omega(t)}\)</span>. The former is given by the <span class="math inline">\(CDF(t)\)</span> of the start-date distribution while the latter is given by the survival function, <span class="math inline">\(S(t)\)</span>, of the end-date distribution.</p>
<p>With these inclusion probabilities, the <code>ChronoCluster</code> package can account for both temporality (change over time in the point pattern) and chronometric uncertainty in the start- and end-dates. One way it handles this is by creating ensembles of probable point sets for a given time by resampling the point set with replacement in accordance with the inclusion probabilities. This resampling amounts to a bootstrap and results in ensembles in which a given point’s representation in the ensemble occurs with a frequency corresponding to its inclusion probability for the relevant time slice. Then, the KDE estimated as described above was produced for each probable point set, resulting in a distribution of smooth KDE-based PDDs for a given time slice and point set. It would also be possible to use the inclusion probabilities to weight the KDEs directly—and the Python package allows for this—but this would result in an averaged estimate that effectively marginalized the chronological uncertainty rather than reflecting it fully. Having a large ensemble of probable PDDs for a given time slice allowed us to use standard methods to represent the uncertainty, like quantile-based uncertainty envelops in PDD function plots, and to propagate it in further analyses.</p>
<p>The empirical PDDs were compared to two null models: a commonly used, uninformative model and a custom, more informative one. These null models allowed us to estimate whether features of a given PDD (modes or troughs) could be considered “significant” in the sense that they differed substantially from what would be expected under the given null. The first null model, <em>Complete Spatial Randomness</em> (CSR), represents a standard assumption in point pattern analysis, while the second, which we term <em>Baseline Informed Spatial Expectation</em> (BISE), incorporates large-scale spatial constraints to better isolate finer-scale structure within the observed point patterns.</p>
<p>CSR assumes that points are uniformly randomly distributed throughout a predefined study region. This model suffers from at least three disqualifying limitations. First, it is unrealistically agnostic about major geographic features that would distort or confine settlement options, leading to non-uniform distributions of points. Unless these large-scale effects are of specific interest, they tend to overshadow the finer, more socially and economically relevant structures. Second, humans, like other organisms, naturally cluster to some extent within any given study area, meaning that one should expect some large-scale clustering that would make any set of relevant points appear clumpy within an arbitrarily defined region. Third, the uniform CSR assumption forces the definition of a study area, which exacerbates edge effects and scaling issues. In this context, edge effects distort patterns by introducing too much empty space into the null model. A useful way to visualize this is to imagine a relatively uniform cloud of points with a tight bounding box around it, then expanding the box outward. The previously uniform distribution of points begins to appear clumpy within the newly expanded bounds, a manifestation of the “modifiable unit area” problem. Despite these limitations, we included a CSR null model for consistency and to highlight the power of our alternative approach.</p>
<p>The BISE model addresses some of CSR’s shortcomings by incorporating large-scale constraints that are not of primary interest. In our case, we sought to separate structure arising from (1) the general tendency of people to cluster within a larger study region and (2) very large-scale landscape constraints, such as the Tonle Sap shoreline in the case of Angkor or the Solent coastline in the case of Hampshire. To account for these influences, our BISE model used a statistical baseline that captured broad spatial clustering patterns, allowing the PDDs to reveal finer-scale structure within the observable cloud of points. Specifically, we modeled the expected spatial distribution as a 2D Gaussian distribution fitted to the empirical point cloud. This meant that the null model was centered on the observed data and had an overall shape and spread aligned with the real point distribution. A significant benefit of this approach is that it avoids the need to arbitrarily define a study area that could introduce or exacerbate edge effects and the modifiable unit area problem.</p>
<p>For both CSR and BISE, we generated simulated ensembles of point sets by drawing new coordinates for each point from the relevant probability distribution while preserving its chronological information. For CSR, new coordinates were sampled from a uniform distribution within a minimal rectangular bounding area encompassing all observed points. For BISE, the coordinates were sampled from the fitted 2D Gaussian distribution. In both cases, this approach produced simulated ensembles that maintained the temporal relationships and uncertainties of the original data while reflecting the spatial variability implied by each null model.</p>
<p>Then, to estimate the statistical significance we calculated the difference between the empirical PDDs and a corresponding null PDD based on simulated data from the relevant null model. This difference was a random variable reflecting chronological uncertainty in the chronometric data (start-/end-distributions) and spatial variability in the null model. For a given time slice and distance in the domain of the PDD, that random variable could be expected—with large enough bootstrap ensembles—to be well approximated by a normal distribution because it was the difference of two continuous density estimates. As a result, we could use that difference variable, <span class="math inline">\(\Delta PDD\)</span>, for inference by assuming that its mean should be zero if there were no difference at a given time and distance between the empirical PDD ensemble and null PDD ensemble. The ensembles were contained in arrays of shape <span class="math inline">\((I, J, K)\)</span>, where <span class="math inline">\(I =\)</span> distance index, <span class="math inline">\(J =\)</span> time slice index, and <span class="math inline">\(K =\)</span> ensemble index. Then, the specific calculations for the “p-values” were as presented below, where <code>obs</code> was an observed array, <code>null</code> was the simulated null baseline array.</p>
<p>Firstly, we calculated the mean difference, <span class="math inline">\(\mu_{\Delta_{ij}}\)</span>, between the observed and null PDD across the bootstrapped samples (axis=2) as follows,</p>
<p><span class="math display">\[
\mu_{\Delta_{ij}} = \frac{1}{N} \sum_{k=1}^{N} (\text{obs}_{ijk} - \text{null}_{ijk})
\]</span></p>
<p>Secondly, we calculated the standard deviation of the differences (<span class="math inline">\(\sigma_{\Delta_{ij}}\)</span>) across the iterations (axis=2):</p>
<p><span class="math display">\[
\sigma_{\Delta_{ij}} = \sqrt{\frac{1}{N} \sum_{k=1}^{N} \left( (\text{obs}_{ijk} - \text{null}_{ijk}) - \mu_{\Delta_{ij}} \right)^2}
\]</span></p>
<p>Thirdly, we calculated the z-scores for each pair of distance and time slice:</p>
<p>$$</p>
<p>&nbsp; &nbsp;z_{_{ij}} = </p>
<p>$$</p>
<p>And, lastly, we calculated the p-value using the CDF, <span class="math inline">\(\Phi(\cdot)\)</span>, of the standard normal distribution:</p>
<p><span class="math display">\[
p = 1 - \Phi(z_{\Delta_{ij}})
\]</span></p>
<p>where low p-values imply positive differences, meaning that the empirical PDD is higher than the null baseline at a given distance. This means that <span class="math inline">\(p \ll 0.5\)</span> implied extreme positive differences under the null hypothesis and, so, we could interpret the resulting p-values in the usual way applying standard thresholds for significance in order to identify statistically significant structure (usually indicating clustering) in the empirical PDDs of each case study. Importantly, these tests accounted for both chronological uncertainty and spatial variation assumed under the relevant null model. It was, however, not necessary to adjust for multiple comparisons becasue we conducted only independent tests at each time-distance index to determine if the empirical function at that location differed from the sample of null PDD functions in the same place—no global test was performed that might be concerned with how many significant deviations occurred.</p>
<p>The data from Angkor had both chronological uncertainty and temporality, which we accounted for by producing a series of PDDs as described above for a series of time slices. Angkor’s temples were founded at different times throughout the Angkorian period from c.&nbsp;800 CE to at least c.1400 CE sometime after which construction slowed or halted and the area went into decline. The precise foundation and construction dates for most of the temples are not known, as we explained. Similarly, the precise abandonment dates are also unknown for the vast majority of temples and so we assigned an end date in line with scholarly convention and broad historical evidence that amounted to a <em>terminus ante quem</em> (“time before which”, or latest possible date) for most temples, even though the evidence is clear that some temples (e.g., Angkor Wat) remained occupied and active right up to the present day. Thus, the end date we selected for Angkor’s temples simply reflects a scholarly norm and is effectively just the recent temporal bound of our study. Nevertheless, we were able to produce a series of PDDs for Angkor that varied and were less certain for earlier times in line with the varying known and modelled foundation dates and the associated modelling uncertainties. In order to make a meaningful comparison to Hampshire, we assessed the series for any evidence of significant change over time and plotted a selection of PDDs corresponding to a series of time slices. We also used a heatmap to represent and examine potential change over time in statistically significant deviations in the PDDs for the Angkor point set. The main objective was to determine which, if any, time slice(s) represented stable spatial logic in Angkor’s urban growth trajectory that could be directly compared to the snapshot we had of Hampshire’s spatial logic.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>Our results revealed key similarities between the two case study regions, with settlement patterns shaped by both large-scale landscape constraints and inherent tendencies toward spatial clustering. These trends were evident in direct visualizations, statistically verified through PDD null model comparisons, and shown to be stable over time in the case of Angkor—recall that that the data for Hampshire were effectively representative of an historical snapshot. The temporal stability at Angkor permitted the direct comparison between Angkor (1000 CE) and Hampshire (1066-86 CE) central to the present study. Importantly, that comparison revealed striking parallels in the spatial logic underlying their respective settlement structures.</p>
<p>Simply plotting the point sets from each region in 3D spacetime volumes suggested that each reflected similar large-scale patterns distorted by the local landscapes. In the case of Angkor, as shown in FIG, while there was variation in the point distribution over the first century or so resulting from the increase in temple construction, there was no obvious evidence of changes in the pattern after about 1000 CE. Additionally, we can see that there does appear to be a general tendency to overall, large scale clustering within the study region, creating the impression of a large, more-or-less oblong single major point cloud with a major axis running northwest to southeast along the shoreline of the Tonle Sap and bounded on the northeast by the Kulen Hills. Similar patterns were observed with the point data from Hampshire. The overall shape of the cloud of estate locations reflects the fact that the Hampshire is geographically bounded primarily on the south by the gently curving coastline. The otherwise fairly round cloud also reveals some visual clumpiness caused by the rolling to hilly terrain cut by wide river valleys and caused by the Isle of Wight to the south separated from the mainland by a narrow straight—overall less constrained than the settlement area of Angkor, making the entire point cloud more round.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Figures/spacetime_volume_combined.png" class="img-fluid figure-img"></p>
<figcaption>SpacetimeVolumes</figcaption>
</figure>
</div>
<p>Comparing the <span class="math inline">\(\Delta PDD\)</span>s with respect to different null models produced statistical support for the impression that large-scale landscape forces shaped the settlement systems, and demonstrated that the BISE null model was indeed better suited for resolving structure independent of those forces. As expected, using the CSR model (uniform random distribution) as the baseline led to the identification of statistically significant but low-information modes in the PDDs. In the case of Angkor, the CSR null highlighted a single broad mode corresponding to the width of the point cloud along its transverse axis. This structure most likely reflects the shape of the settlement area, compressed between the lake and the hills, with its longest axis running parallel to the lake shore, as predicted. The relationship between the null models and the empirical PDD for Angkor is presented in FIG, showing that the elongated Gaussian BISE distribution accounts for much of the overall point pattern structure and follows the empirical PDD more closely than the CSR model. This is because the BISE captures both the landscape’s shape and the natural tendency of humans to cluster into the most spatially efficient configuration that the environment, available resources, and social dynamcis allow. Subtracting the BISE from the empirical PDD revealed finer-scale socioeconomic and social structuring that could not be observed using the CSR null. Likewise, the BISE model improved spatial resolution in the PDD for Hampshire, where it primarily captures natural gravity-like clustering in the settlement pattern. As expected, the CSR model overestimates the frequency of longer distances while underestimating shorter ones, failing to reflect the pull of human settlements toward denser cores. With fewer major geographic constraints, Hampshire’s point cloud is rounder than Angkor’s, something the BISE captures but the CSR does not. In both cases, the BISE model isolates structure more relevant to societal, economic, and cultural differences in urbanism by controlling for broad clustering tendencies.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Figures/pdd_nulls_angkor.png" class="img-fluid figure-img"></p>
<figcaption><span class="math inline">\(\Delta\)</span>PDD Angkor</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Figures/pdd_nulls_hampshire.png" class="img-fluid figure-img"></p>
<figcaption><span class="math inline">\(\Delta\)</span>PDD Hampshire</figcaption>
</figure>
</div>
<p>Crucially, for present purposes, the PDD results for Angkor indicated enough temporal stability that we could compare it to the historical snapshot we had for Hampshire. Plotted as a heatmap (FIG) and a series of time slices (FIG), the PDDs indicate that the spatial logic underlying Angkor’s structure was in place by 1000 CE and remained largely stable over the subsequent centuries. As FIG shows, there is greater uncertainty before 1000 CE in terms of the structure of PDD (lower statistical significance and more blurring across the distance domain). This pattern is accounted for by the uncertain foundation dates (more blurring) and the process of urban growth/development characterised by relatively few early temples followed by a building boom throughout the 10th century (shifting bright regions in the heatmap). This boom in construction is consistent with historical records and the existing scholarly consensus. Interestingly, though, our results revealed remarkable stability in the overall PDD structure despite both the uncertainty and the growth process. This means that the spatial logic underlying urban growth at Angkor was likely set early on and persisted despite massive growth in population and the passage of several centuries. It also meant that we could use a time slice from at or after 1000 CE for direct comparison with Hampshire without needing to make further comparisons for each subsequent time slice.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Figures/ppdd_hm_angkor_bise.png" class="img-fluid figure-img"></p>
<figcaption><span class="math inline">\(\Delta\)</span>PDD Heatmap for Angkor</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Figures/dpdd_series_angkor_bise.png" title="$\Delta$PDD Time Series Slices for Angkor" class="img-fluid figure-img"></p>
<figcaption><span class="math inline">\(\Delta\)</span>PDD Time Series Slices for Angkor</figcaption>
</figure>
</div>
<p>Finally, the direct comparison between the PDDs from Angkor (1000 CE) and Hampshire (1066-86 CE) revealed striking similarity. In each case, the function increases rapidly at the low-distance end of the domain and then declines, forming a first discrete mode. Then, the function declines into a large negative trough, before rebounding into the positive space and following a trajectory that creates a second, wider mode. Lastly, both functions come down again off the second mode, trailing to effectively zero for the rest of the function domain. This behaviour, somewhat like a damped oscilliation, indicates the presence of two statistically significant modes in the PDDs of both point sets. The first mode is much more distinct, implying a shorter-distance clustering where we would observe higher densities of points (estates in the case of Hampshire and temples at Angkor). The second mode, being much wider and more gradual, implies that there is some large-scale clustering beyond what would be expected under the BISE, perhaps a second order clustering of the more discrete, smaller-scale clusters responsible for the first mode. But, this second mode is much less distinct than the first, which suggests it would be harder to identify visually. Nevertheless, in both cases the bimodal, damped oscillator structure implies at least two scales of clustering are observable (at least statistically) in both cases.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Figures/dpdd_series_hampshire_bise.png" class="img-fluid figure-img"></p>
<figcaption><span class="math inline">\(\Delta\)</span>PDD BISE for Hamphsire</figcaption>
</figure>
</div>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>If Angkor and Hampshire represented fundamentally different types of urbanism—the former as low-density agro-urban and the latter as urbs-ex-rural—we would expect their spatial structure to be starkly divergent. Yet, we found some compelling similarities in the wave-like pattern of the PDDs, representing multi-scalar spatial clustering. In fact, after examining our results, we noticed something rather surprising. When Angkor’s PDD is rescaled by a factor of 1.5–2, it aligns remarkably with Hampshire’s (FIG). This convergence suggests that rather than representing two distinct urban traditions, these settlements may be scaled manifestations of a shared underlying spatial logic.</p>
<p>To us, this alignment has several immediate and important implications. Firstly, the now widely accepted distinction between low-density and compact premodern urban forms needs to be reconsidered. Since its introduction to the archaeological literature, this distinction has been applied beyond Angkor to Maya cities, to ancient Sri Lankan centers, and to Amazonian settlements that have only recently been mapped with LiDAR. In part, this expansion reflects an effort to broaden definitions of urbanism to include settlements that do not conform to outdated, Eurocentric, density-based models while still exhibiting other traits associated with urbanism. And, on one hand, our findings could be read as further eroding the conceptual walls around urbanism, expanding the category. On the other hand, however, our findings reveal structural similarities between a prototypical low-density, non-European urban landscape and a European one. This finding does challenge the notion that urbanism was ever a unique phenomenon, much less particular to Europe. But, it also calls into question the need for the ‘low-density’ modifier at all, which may actually have, ironically, served to create exceptions rather than grow the urban category. More importantly, it may be hindering a globally-relevant understanding of urban processes and forms.</p>
<p>Secondly, the assumption that low-density urban centers were inherently unstable in the past—and therefore unsustainable in the future—should be questioned. As we explained, this premise provided an urgent framing for research on premodern low-density urbanism. It was a compelling way to make studies of Angkor and other apparently low-density ancient cities, such as those of the Classic Maya, directly relevant to contemporary concerns about urban sprawl, ecological footprints, and sustainability in the face of rapid anthropogenic climate change. If ancient low-density urban forms once existed but failed to persist into the present—while more compact, urbs-ex-rural cities have continued to exist over the same timescales—this could imply a troubling pattern: that low-density urbanism is inherently unstable. It would suggest that the ongoing de-densification of post-industrial cities is actually leading toward collapse. However, our findings suggest that cities labelled low-density in the past may, in fact, have been scaled variants of the same urban structures seen in other premodern cities. If so, then concerns about their inherent instability may be misplaced. Additionally, there is no reason to assume that the European case represents the default. One could just as easily interpret Hampshire as a scaled-up version of Angkor—suggesting that it, too, represents a form of low-density urban-agrarian integration. If similar patterns hold across other European cases, then it follows that all premodern urban systems may have functioned, to varying degrees, like Angkor. If this is the case, then the persistence of settlement areas such as Winchester—inhabited for millennia and still an active urban center—demonstrates that de-densification alone is no cause for concern. Low-density urban systems, rather than being inherently unstable, may instead represent one enduring form of urban organization among many, just another stable state on a continuum of urban forms emerging from a single urban process.</p>
<p>Lastly, apparent differences in urban form should not be taken as evidence of types, but rather manifestations of an archetype. The dominant, top-down approach to defining premodern cities has relied on assumed categories—treating features such as walls, density estimates, or monumental cores as definitive markers of urbanism. Yet, in doing so, it risks what might be called “begging the category”. We see this as a form of circular reasoning in which cities are classified based on predefined expectations, and those classifications are then used to justify the very distinctions they presume. Instead of first identifying what actually structured life within a given settlement area, these approaches begin by assigning a site urban status, drawing a boundary, and estimating population density based on those initial assumptions. This is precisely the kind of reasoning the field has sought to move away from (e.g., Smith), particularly as it pertains to simplistic markers like walls as definitive indicators of city status, which is a hold-over from the Childean/Weberian and even ancient Greek and Roman view of “The City”.</p>
<p>For our study, we used an alternative, bottom-up approach. We identified at Angkor specific structures that have been used to visually classify it as low-density, examined their social and economic role, found socioeconomic and political analogues in another case (i.e., Hampshire’s manorial estates), and then compared the two directly. This comparative method reveals that rather than discrete urban types, these urban-rural landscapes exhibit variations of a shared underlying spatial and functional logic. If such structures emerge repeatedly across different regions and time periods, then the notion of low-density urbanism as a distinct category may not reflect actual urban diversity, but rather an artifact of circular classification. This bottom-up approach allowed us to see past rigid classifications and recognize an urban archetype rather than a set of distinct types. Rather than viewing urban forms as separate entities bound by categorical constraints, our findings suggest that urbanism is best understood as a recurring organizing principle. It arises from a common human process—one that manifests differently across regions and time periods but is governed by common principles of organization, infrastructure, and spatial interaction. When we remove the assumption that cities must fit into predefined models, we can instead study them as dynamic systems that adapt a common archetype to local environmental, economic, and sociopolitical conditions.</p>
<p>Our findings—and the broader inferences they reveal—align with Settlement Scaling Theory (SST). SST was introduced by Bettencourt in a highly influential, paradigm-shifting paper. It suggests that human settlements, regardless of time or place, exhibit predictable relationships between population, spatial organization, and infrastructure density. Its mathematical predictions have been born out repeatedly, including in tests involving archaeological and historical cities. Geoffery West, in his popular book “Scale”, describes it as revealing the existence of a “Platonic city” that is scaled, as its population grows, in precise, quantitatively predictable ways—that is, all cities are manifestations of an underlying archetype. The striking PDD convergence between Angkor and Hampshire supports this idea, albeit from a spatial structural perspective, rather than a population scaling one. We propose that urban clustering follows universal scaling principles, rather than being driven solely by historical contingencies or cultural traditions, giving rise to the observable variability in urban form across space, time, and culture.</p>
<p>While revealing, our study had two key limitations. First, we compared only two cases directly. It remains possible that other ancient cities currently identified as distinctive low-density types—such as Classic Maya centers or recently mapped Amazonian settlements—would continue to appear distinct even if compared to one or more urbs-ex-rural cases. However, our findings demonstrate that Angkor, the original type site for the low-density model, is far more similar than previously recognized to a case that has not been labelled low-density. Importantly, as we argued, there are sufficient socioeconomic and political parallels with respect to the meaning of the individual points in both cases to justify a bottom-up direct comparison. This challenges the validity of the label itself, even though we cannot yet determine whether a distinctive low-density category exists, or existed at some point, globally.</p>
<p>Second, our study was constrained by the available data. For Hampshire, we primarily relied on the Domesday Survey, which provides only a snapshot of the urban-rural system as it existed in the late Anglo-Saxon period. For Angkor, our chronology is based largely on modelled dates for temple construction and a single historically normative date for abandonment—the conventional endpoint of the Angkorian period. To fully capture the temporality of urban development, it would be ideal to have higher-resolution chronological data for Angkor and a more temporally variable point pattern for the comparator. Still, after accounting for chronometric uncertainties—including modelled uncertainties for the Angkor point set—our results indicate that the spatial structures observed in both cases persisted for at least several centuries. Thus, at the point of comparison, the patterns we identified reflect real, long-standing urban forms rather than transient anomalies.</p>
<p>We identify two major avenues for future research. First, if our findings are replicated across cultures and time periods, the idea of a “Platonic city” will become an increasingly compelling description of human social, economic, and political organization in urban societies. As scaling research continues to accumulate evidence for universal urban trait scaling, further work on spatially explicit scaling could deepen discussions on what urbanism really is, how it emerges, and in what ways it varies through space and time. Once appropriate datasets have been compiled, our study could be repeated for point sets representing Classic Maya urbanism in Mesoamerica, Anuradhapura-period urbanism in Sri Lanka, and pre-Colonial Amazonian urbanism—all of which have been classified as low-density urban forms.</p>
<p>Second, the source of the observed scaling differences warrants further investigation. In our case study, the spatial scaling factor between Angkor and Hampshire was approximately 2. This specific value may be significant. For instance, the ratio between the speed of an ambling horse and that of a walking human is also roughly 2. In medieval England, specific horse breeds were preferred for this gait, particularly among elites who needed to move efficiently between manorial estates. In contrast, horses were not widely used at Angkor and were generally uncommon in the tropics, where most premodern low-density cities have been identified. This raises the possibility that scaling differences may reflect fundamental factors such as modal transportation speeds, climate, agricultural land-use systems, and/or terrain. Testing this hypothesis across additional cases could reveal whether such environmental and infrastructural constraints systematically shape urban scaling patterns and would functionally link the “Platonic” form to the real variability we observe.</p>
<p>Urbanism has long been a defining arena for human interaction and it will only become more central to shaping human life as the share of people living in cities increases. Our findings add a key, independent line of evidence to the growing body of research from scaling theory, suggesting that urbanism is not merely a historical contingency but a recurring, perhaps inevitable, outcome of collective human behavior at scale. As both a product and a driver of social, political, and economic organization, it is crucial that we refine our understanding of its true nature, structure, development, and variability. Doing so will not only deepen our understanding of human behavior but also improve our ability to craft sustainable policies that align with the fundamental processes shaping urban life.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>